<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClubHub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            transition: background 0.3s, color 0.3s;
        }

        body.dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: #f3f4f6;
        }

        body.light {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%);
            color: #111827;
        }

        .card {
            border-radius: 1rem;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            border: 1px solid;
        }

        body.dark .card {
            background: rgba(30, 41, 59, 0.6);
            border-color: #334155;
        }

        body.light .card {
            background: rgba(255, 255, 255, 0.9);
            border-color: #e5e7eb;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.3);
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(20px);
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
        }

        .logo {
            font-size: 1.875rem;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .nav button {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 0.625rem 1.25rem;
            border-radius: 0.75rem;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav button:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            transform: translateY(-1px);
        }

        .nav button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            transition: all 0.3s;
            transform: translateX(-50%);
        }

        .nav button:hover::after {
            width: 80%;
        }

        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9375rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: width 0.6s, height 0.6s, top 0.6s, left 0.6s;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #6b7280;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
            transform: translateY(-2px);
        }

        .grid {
            display: grid;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        }

        .input, .textarea, .select {
            width: 100%;
            padding: 0.875rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid;
            transition: all 0.3s;
            font-size: 0.9375rem;
        }

        body.dark .input, body.dark .textarea, body.dark .select {
            background: rgba(51, 65, 85, 0.5);
            border-color: #475569;
            color: #f3f4f6;
        }

        body.light .input, body.light .textarea, body.light .select {
            background: rgba(249, 250, 251, 0.8);
            border-color: #d1d5db;
            color: #111827;
        }

        .input:focus, .textarea:focus, .select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 42rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .club-card {
            cursor: pointer;
            transition: all 0.3s;
            overflow: hidden;
        }

        .club-card:hover {
            transform: translateY(-8px) scale(1.02);
        }

        .club-image {
            width: 100%;
            height: 14rem;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .club-card:hover .club-image {
            transform: scale(1.1);
        }

        .avatar {
            width: 6rem;
            height: 6rem;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .stat-card {
            text-align: center;
            padding: 2rem;
            border-radius: 1rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px solid;
            border-color: rgba(59, 130, 246, 0.3);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 1rem;
            font-weight: 600;
            color: #9ca3af;
            margin-top: 0.5rem;
        }

        .hidden {
            display: none !important;
        }

        .login-container {
            max-width: 28rem;
            margin: 5rem auto;
        }

        .title {
            font-size: 2.25rem;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
        }

        .announcement-item, .event-item, .club-item {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s;
            border: 1px solid;
        }

        body.dark .announcement-item, body.dark .event-item, body.dark .club-item {
            background: rgba(51, 65, 85, 0.5);
            border-color: #475569;
        }

        body.light .announcement-item, body.light .event-item, body.light .club-item {
            background: rgba(249, 250, 251, 0.9);
            border-color: #e5e7eb;
        }

        .announcement-item:hover, .event-item:hover, .club-item:hover {
            transform: translateX(4px);
            border-color: #3b82f6;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #9ca3af;
            font-size: 1.125rem;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .error, .success {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 500;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #9ca3af;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        /* Signup Modal */
.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(8px);
    z-index: 100;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    animation: fadeIn 0.3s;
}

body.dark a {
    color: #60a5fa;
}

body.dark a:hover {
    text-decoration: underline;
}


/* Modal Transition */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal.active {
    display: flex;
}

/* Signup Card */
.card {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
}

/* Title for the Signup Form */
.title {
    font-size: 2.25rem;
    font-weight: 900;
    background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1.5rem;
}

/* Form Inputs */
.input {
    width: 100%;
    padding: 1rem;
    border-radius: 0.75rem;
    border: 2px solid;
    transition: all 0.3s;
    font-size: 1rem;
    margin-bottom: 1rem;
}

.input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Buttons */
.btn-primary {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
    padding: 1rem;
    border-radius: 0.75rem;
    width: 100%;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.3s;
}

.btn-primary:hover {
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
    transform: translateY(-2px);
}

.btn-primary:disabled {
    background: #6b7280;
    cursor: not-allowed;
    box-shadow: none;
}

/* Text for Login Redirect */
.text-center {
    text-align: center;
    font-size: 0.875rem;
}

.text-blue-500 {
    color: #3b82f6;
}

.text-blue-500:hover {
    text-decoration: underline;
}
.label {
  display: block;
  margin-bottom: 0.4rem;
  font-weight: 600;
  color: #f3f4f6;
}

.textarea, .input {
  width: 100%;
  padding: 0.875rem 1rem;
  border-radius: 0.75rem;
  border: 2px solid rgba(255,255,255,0.1);
  background: rgba(30,41,59,0.5);
  color: #f3f4f6;
  font-size: 0.9375rem;
}
#leader-dashboard section {
  margin-top: 2rem;
  padding: 1rem;
  border-radius: 12px;
  background: var(--card-bg, #222);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

#membership-section {
  background-color: #2b2b2b;
}

#members-section {
  background-color: #1f1f1f;
}

#announcements-section {
  background-color: #262626;
}



        @media (max-width: 768px) {
            .grid-3, .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .nav {
                flex-wrap: wrap;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body class="dark">
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h1 class="logo">ClubHub</h1>
                <button onclick="toggleTheme()" class="btn">â˜¾</button>
            </div>
            
            <div id="loginError" class="error hidden"></div>
            <div id="loginSuccess" class="success hidden"></div>
            
            <form onsubmit="login(event)">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Email</label>
                    <input type="email" id="loginEmail" class="input" placeholder="your@email.com" required>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Password</label>
                    <input type="password" id="loginPassword" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                </div>
                
                <button type="submit" id="loginBtn" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
            
            <p style="margin-top: 1rem; text-align: center;">
            Don't have an account? 
             <a href="#" onclick="showSignup()">Sign Up</a>
            </p>

            
            
        </div>
    </div>
    <!-- Signup Page -->
<div id="signupPage" class="login-container hidden">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 class="logo">ClubHub</h1>
            <button onclick="toggleTheme()" class="btn">ðŸŒ˜</button>
        </div>

        <div id="signupError" class="error hidden"></div>
        <div id="signupSuccess" class="success hidden"></div>

        <form id="signupForm" onsubmit="signup(event)">
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Full Name</label>
                <input type="text" id="signupName" class="input" placeholder="Your Name" required>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Student ID</label>
                <input type="text" id="signupStudentID" class="input" placeholder="12345678" required>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Email</label>
                <input type="email" id="signupEmail" class="input" placeholder="your@email.com" required>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Password</label>
                <input type="password" id="signupPassword" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
            </div>

            <button id="signupBtn" type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
        </form>

        <p style="margin-top: 1rem; text-align: center; color: inherit;">
            Already have an account?
            <a href="#" onclick="showLogin()" style="color: #3b82f6; text-decoration: none;">Login</a>
        </p>
    </div>
</div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="header card">
            <div class="header-content container">
                <h1 class="logo">ClubHub</h1>
                
                <nav class="nav">
                    <button onclick="showPage('dashboard')">Dashboard</button>
                    <button onclick="showPage('clubs')">Clubs</button>
                    <button onclick="showPage('profile')">Profile</button>
                    <button onclick="toggleTheme()">â˜¾</button>
                    <button onclick="logout()" class="btn btn-danger">Logout</button>
                </nav>
            </div>
        </header>

        <main class="container" style="padding-top: 2rem; padding-bottom: 4rem;">
            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="hidden">
                <div class="section-header">
                    <h2 class="title">Admin Dashboard</h2>
                    <span class="badge">Administrator</span>
                </div>
                
                <div class="grid grid-3" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-number" id="statsClubs">0</div>
                        <div class="stat-label">Total Clubs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statsMembers">0</div>
                        <div class="stat-label">Total Members</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statsEvents">0</div>
                        <div class="stat-label">Total Events</div>
                    </div>
                </div>
                
                <div class="grid grid-2">
                    <div class="card">
                        <div class="section-header">
                            <h3 style="font-size: 1.25rem; font-weight: bold;">Quick Actions</h3>
                        </div>
                        <button onclick="openModal('createClub')" class="btn btn-primary" style="width: 100%; margin-bottom: 0.75rem;">Create Club</button>
                        <button onclick="openModal('assignLeader')" class="btn btn-secondary" style="width: 100%; margin-bottom: 0.75rem;">Assign Club Leader</button>
                        <button onclick="openModal('announcement')" class="btn btn-secondary" style="width: 100%; margin-bottom: 0.75rem;">Post Announcement</button>
                    </div>
                    <div class="card">
                        <div class="section-header">
                            <h3 style="font-size: 1.25rem; font-weight: bold;">Recent Announcements</h3>
                        </div>
                        <div id="adminAnnouncements"></div>
                    </div>
                </div>
            </div>

<!-- Leader Dashboard -->
<div id="leaderDashboard" class="hidden">
  <div class="section-header">
    <h2 class="title">Leader Dashboard</h2>
    <span class="badge">Leader</span>
  </div>

  <!-- Top Info Section -->
  <div class="grid grid-2" style="margin-bottom: 1.5rem;">
    <!-- Quick Actions -->
    <div class="card">
      <div class="section-header">
        <h3 style="font-size: 1.25rem; font-weight: bold;">Quick Actions (Your Club)</h3>
      </div>
      <button id="leaderPostAnnouncementBtn" onclick="openModalForClub('announcement')" class="btn btn-secondary" style="width:100%; margin-bottom:0.75rem;">
         Post Club Announcement
      </button>
      <button id="leaderCreateEventBtn" onclick="openModalForClub('event')" class="btn btn-primary" style="width:100%; margin-bottom:0.75rem;">
         Create Club Event
      </button>
      <button id="leaderMembershipBtn"
          onclick="openLeaderMembershipModal()"
          class="btn btn-secondary"
          style="width:100%; margin-bottom:0.75rem;">
     Manage Membership
    </button>
    </div>



    <!-- Club Info -->
    <div class="card">
      <div class="section-header">
        <h3 style="font-size: 1.25rem; font-weight: bold;">Club Info</h3>
      </div>
      <div id="leaderClubInfo">
        <!-- JS will populate club name, description, total members, etc. -->
        <p style="color:#9ca3af;">Loading your club details...</p>
      </div>
    </div>
  </div>

<!-- Club Membership Section -->
<div id="leaderMembershipSection" class="card" style="
  margin-top: 1.5rem;
  padding: 1.5rem;
  border-radius: 0.75rem;
  background: rgba(255,255,255,0.05);
  color: white;
">
  <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">Club Membership</h3>

  <div id="membershipDetails" style="margin-bottom: 1rem;">
    <p><strong>Account Name:</strong> <span id="memName">â€”</span></p>
    <p><strong>Account Number:</strong> <span id="memNumber">â€”</span></p>
    <p><strong>Description:</strong> <span id="memDesc">â€”</span></p>
    <div id="memImageContainer" style="margin-top:1rem; display:none;">
      <p><strong>QR / Payment Image:</strong></p>
      <img id="memImage" src="" alt="Membership QR" style="width:150px; border-radius:0.5rem;">
    </div>
  </div>

  <button class="btn btn-primary" onclick="openLeaderMembershipModal()">Update Membership</button>
</div>


  <!-- Announcements Section -->
  <div class="card" style="margin-bottom:1.5rem;">
    <div class="section-header">
      <h3 style="font-size: 1.25rem; font-weight: bold;">Your Club Announcements</h3>
    </div>
    <div id="leaderAnnouncementsList">
      <p style="color:#9ca3af;">No announcements yet.</p>
    </div>
  </div>

  <!-- Events Section -->
  <div class="card" style="margin-bottom:1.5rem;">
    <div class="section-header">
      <h3 style="font-size: 1.25rem; font-weight: bold;">Your Club Events</h3>
    </div>
    <div id="leaderEventsList">
      <p style="color:#9ca3af;">No events yet.</p>
    </div>
  </div>

 


  <!-- Members Section -->
  <div class="card">
    <div class="section-header">
      <h3 style="font-size: 1.25rem; font-weight: bold;">Club Members</h3>
      <small style="color:#9ca3af;">You can remove members from your club</small>
    </div>
    <div id="leaderMembersList">
      <p style="color:#9ca3af;">No members found.</p>
    </div>
  </div>
</div>

 

                <!-- Member Dashboard -->
<div id="memberDashboard" class="hidden">
  <div class="section-header">
    <h2 class="title">Member Dashboard</h2>
    <span class="badge">Member</span>
  </div>
  
  <div class="grid grid-2">
    <div class="card">
      <div class="section-header">
        <h3 style="font-size: 1.25rem; font-weight: bold;">My Clubs</h3>
      </div>
      <div id="memberClubs"></div>
      <button onclick="showPage('clubs')" class="btn btn-primary" style="width: 100%; margin-top: 1rem;"> Browse Clubs</button>
    </div>
    
    <div class="card">
      <div class="section-header">
        <h3 style="font-size: 1.25rem; font-weight: bold;">Upcoming Events</h3>
      </div>
      <div id="memberEvents"></div>
    </div>
    
    <div class="card">
      <div class="section-header">
        <h3 style="font-size: 1.25rem; font-weight: bold;">Announcements</h3>
      </div>
      <div id="memberAnnouncements"></div>
    </div>
  </div>
</div>

<!-- Profile Page (moved outside member dashboard) -->
  <div id="profilePage" class="hidden">
  <h2 class="title">My Profile</h2>

  <div class="card" style="max-width: 42rem; margin: 0 auto; padding: 2rem;">
    <!-- Profile Header -->
    <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 2rem;">
      <div class="avatar" id="profileAvatar">A</div>
      <div>
        <h3 id="profileName" style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.25rem;">User</h3>
        <p id="profileEmail" style="color: #9ca3af; margin-bottom: 0.5rem;">email@example.com</p>
        <span id="profileRole" class="badge">Member</span>
      </div>
  </div>

  <!-- Ensure profile clubs container exists -->
  <div id="profileClubs" style="display:none"></div>

    <!-- Basic Info -->
    <div id="basicInfo">
      <p><strong>Student ID:</strong> <span id="profileID"></span></p>
      <p><strong>Birthday:</strong> <span id="profileBirthday"></span></p>
      <p><strong>Joined:</strong> <span id="profileJoined"></span></p>
      <p><strong>Course:</strong> <span id="profileCourse"></span></p>
      <p><strong>Year Level:</strong> <span id="profileYearSection"></span></p>
      <p><strong>About Me:</strong> <span id="profileAbout"></span></p>
    </div>

    <!-- Action Buttons -->
    <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
      <button id="editProfileBtn" class="btn">Edit Profile</button>
      <button id="changePasswordBtn" class="btn-secondary">Change Password</button>
    </div>

    <!-- Edit Profile Form -->
    <form id="editProfileForm" class="hidden" style="margin-top: 2rem;">
      <h4 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">Edit Profile Information</h4>

      <label for="editName">Name</label>
      <input type="text" id="editName" placeholder="Enter your name" class="input">

      <label for="editUsername">Username</label>
      <input type="text" id="editUsername" placeholder="Enter your username" class="input">

      <label for="editEmail">Email</label>
      <input type="email" id="editEmail" placeholder="Enter your email" class="input">

      <label for="editBirthday">Birthday</label>
      <input type="date" id="editBirthday" class="input">

      <label for="editAbout">About Me</label>
      <textarea id="editAbout" placeholder="Write something about yourself..." class="input"></textarea>

      <label for="editYearSection">Year Level</label>
      <input type="text" id="editYearSection" placeholder="Ex. BSIT 3A" class="input">

      <label for="editCourse">Course</label>
      <input type="text" id="editCourse" placeholder="Ex. Bachelor of Science in IT" class="input">

      <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">Save Changes</button>
    </form>

    <!-- Badges Section -->
    <div class="badges-section" style="margin-top: 2rem;">
      <h4 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">Badges</h4>
      <p style="color: #9ca3af;">No badges available yet</p>
    </div>
  </div>
</div>
 
            <!-- Clubs Page -->
            <div id="clubsPage" class="hidden">
                <h2 class="title">Clubs Directory</h2>
                
                <div id="clubsGrid" class="grid grid-3">
                    <div class="loading">Loading clubs</div>
                </div>
            </div>

           <!-- Profile Page -->



            
        </main>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content card" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 id="modalTitle" style="font-size: 1.5rem; font-weight: bold;">Modal</h3>
                <button onclick="closeModal()" class="btn" style="padding: 0.5rem 1rem;">âœ•</button>
            </div>
            
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // API Configuration - automatically uses your Cloudflare Pages domain
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:8788/api'  // For local development
            : '/api';  // For production (Cloudflare Pages)

        let database = {
            clubs: [],
            generalAnnouncements: [],
            generalEvents: []
        };

        let currentUser = null;

        // API Helper
        async function apiCall(endpoint, options = {}) {
            try {
                console.log(`API Call: ${endpoint}`, options);
                
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                const data = await response.json();
                console.log(`API Response:`, data);
                
                if (!response.ok) {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        async function loadInitialData() {
            try {
                const [clubsData, announcementsData, eventsData] = await Promise.all([
                    apiCall('/clubs'),
                    apiCall('/announcements'),
                    apiCall('/events')
                ]);
                
                database.clubs = clubsData.clubs || [];
                database.generalAnnouncements = announcementsData.announcements || [];
                database.generalEvents = eventsData.events || [];
                
                console.log('Loaded data:', database);
        // ensure announcements are available for dashboards
        await loadAnnouncements();
            } catch (error) {
                console.error('Failed to load data:', error);
                showMessage('Failed to load data. Please refresh.', 'error');
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            document.body.classList.toggle('light');
        }

        function showMessage(message, type = 'error') {
            const id = type === 'error' ? 'loginError' : 'loginSuccess';
            const el = document.getElementById(id);
            if (el) {
                el.textContent = message;
                el.classList.remove('hidden');
                setTimeout(() => el.classList.add('hidden'), 5000);
            } else {
                alert(message);
            }
        }

        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';
            
            try {
                const data = await apiCall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                currentUser = data.user;
                // persist session locally so page reloads keep the user
                try { localStorage.setItem('user', JSON.stringify(currentUser)); } catch {}
                console.log('Logged in user:', currentUser);
                
                await loadInitialData();
                
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                showPage('dashboard');
            } catch (error) {
                showMessage(error.message || 'Invalid credentials', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
            }
        }

      function showPage(page) {
    document.getElementById('adminDashboard').classList.add('hidden');
    document.getElementById('leaderDashboard').classList.add('hidden');
    document.getElementById('memberDashboard').classList.add('hidden');
    document.getElementById('clubsPage').classList.add('hidden');
    document.getElementById('profilePage').classList.add('hidden');

    if (page === 'dashboard') {
        if (currentUser.role === 'Admin') {
            document.getElementById('adminDashboard').classList.remove('hidden');
            renderAdminDashboard();
        } else if (
            currentUser.role === 'Leader' ||
            currentUser.type === 'Leader' ||
            currentUser.leaderOf
        ) {
            document.getElementById('leaderDashboard').classList.remove('hidden');
            renderLeaderDashboard();
        } else {
            document.getElementById('memberDashboard').classList.remove('hidden');
            renderMemberDashboard();
        }
    } else if (page === 'clubs') {
        document.getElementById('clubsPage').classList.remove('hidden');
        renderClubs();
    }
    else if (page === 'profile') {
    document.getElementById('profilePage').classList.remove('hidden');
    renderProfile();

    // Attach button listener dynamically
    const editBtn = document.getElementById('editProfileBtn');
    const editForm = document.getElementById('editProfileForm');
    const basicInfo = document.getElementById('basicInfo');

    if (editBtn && editForm && basicInfo) {
        editBtn.onclick = () => {
            const isHidden = editForm.classList.contains('hidden');
            editForm.classList.toggle('hidden', !isHidden);
            basicInfo.classList.toggle('hidden', isHidden);
            editBtn.textContent = isHidden ? 'Cancel Edit' : 'Edit Profile';
        };
          }}}

        async function renderAdminDashboard() {
            try {
                const statsData = await apiCall('/stats');
                
                document.getElementById('statsClubs').textContent = statsData.stats.totalClubs;
                document.getElementById('statsMembers').textContent = statsData.stats.totalMembers;
                document.getElementById('statsEvents').textContent = statsData.stats.totalEvents;

                
                const announcementsDiv = document.getElementById('adminAnnouncements');
                announcementsDiv.innerHTML = '';
                
                if (database.generalAnnouncements.length > 0) {
                    database.generalAnnouncements.slice(0, 3).forEach(ann => {
                        const div = document.createElement('div');
                        div.className = 'announcement-item';
                        div.innerHTML = `
                            <p style="font-weight: 500;">${ann.text}</p>
                            <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">ðŸ“… ${ann.date}</p>
                        `;
                        announcementsDiv.appendChild(div);
                    });
                } else {
                    announcementsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ðŸ“¢</div><p>No announcements yet</p></div>';
                }
            } catch (error) {
                console.error('Failed to render admin dashboard:', error);
            }
        }

        function renderMemberDashboard() {
           const clubsDiv = document.getElementById('memberClubs');
clubsDiv.innerHTML = '';

if (currentUser.clubs && currentUser.clubs.length > 0) {
  const grid = document.createElement('div');
  grid.className = 'grid grid-3';

  currentUser.clubs.forEach(clubId => {
    const club = database.clubs.find(c => c.id === clubId);
    if (club) {
      const card = document.createElement('div');
      card.className = 'card club-card';
      card.style.cursor = 'pointer';
      card.onclick = () => openMemberClubModal(club);
      card.innerHTML = `
        <div style="display:flex; justify-content:center; align-items:center; height:180px; overflow:hidden; margin-bottom:1rem;">
          <img src="${club.image}" alt="${club.name}" class="club-image" style="height:100%; width:auto; border-radius:0.75rem;">
        </div>
        <div>
          <h3 style="font-size:1.25rem; font-weight:bold; text-align:center; margin-bottom:0.5rem;">${club.name}</h3>
          <p style="text-align:center; color:#9ca3af;">ðŸ‘¥ ${club.members?.length || 0} members</p>
        </div>
      `;
      grid.appendChild(card);
    }
  });

  clubsDiv.appendChild(grid);
} else {
  clubsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ðŸŽ­</div><p>You haven\'t joined any clubs yet</p></div>';
}

            
            const eventsDiv = document.getElementById('memberEvents');
            eventsDiv.innerHTML = '';
            
            if (database.generalEvents.length > 0) {
                database.generalEvents.slice(0, 5).forEach(event => {
                    const div = document.createElement('div');
                    div.className = 'event-item';
                    div.innerHTML = `
                        <p style="font-weight: 600;">${event.title}</p>
                        <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 0.25rem;">${event.date}</p>
                    `;
                    eventsDiv.appendChild(div);
                });
            } else {
                eventsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><p>No upcoming events</p></div>';
            }
            
            const announcementsDiv = document.getElementById('memberAnnouncements');
            announcementsDiv.innerHTML = '';
            
            if (database.generalAnnouncements.length > 0) {
                database.generalAnnouncements.slice(0, 3).forEach(ann => {
                    const div = document.createElement('div');
                    div.className = 'announcement-item';
                    div.innerHTML = `
                        <p style="font-weight: 500;">${ann.text}</p>
                        <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem;">ðŸ“… ${ann.date}</p>
                    `;
                    announcementsDiv.appendChild(div);
                });
            } else {
                announcementsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ðŸ“¢</div><p>No announcements yet</p></div>';
            }
        }

        // ===============================
// Leader Dashboard Renderer
// ===============================
async function renderLeaderDashboard() {
  try {
    const leaderClubId = currentUser.leaderOf || null;

    if (!leaderClubId) {
      document.getElementById('leaderClubInfo').innerHTML = `<p style="color:#9ca3af;">You are not assigned as a leader of any club.</p>`;
      return;
    }

    // Fetch the leader's club from API
    const clubData = await apiCall(`/clubs/${leaderClubId}`);

    // âœ… Club Info
    document.getElementById('leaderClubInfo').innerHTML = `
      <p><strong>Name:</strong> ${clubData.club.name}</p>
      <p><strong>Description:</strong> ${clubData.club.description}</p>
      <p><strong>Members:</strong> ${clubData.club.members.length}</p>
    `;

    // âœ… Announcements
    const announcementsList = document.getElementById('leaderAnnouncementsList');
    announcementsList.innerHTML = '';
    if (clubData.club.announcements.length > 0) {
      clubData.club.announcements.forEach(a => {
        const div = document.createElement('div');
        div.className = 'announcement-item';
        div.innerHTML = `
          <p>${a.text}</p>
          <p style="font-size:0.75rem; color:#9ca3af;">ðŸ“… ${a.date}</p>
          <button class="btn btn-danger" style="margin-top:5px;" onclick="deleteClubAnnouncement(${leaderClubId}, ${a.id})">ðŸ—‘ Remove</button>
        `;
        announcementsList.appendChild(div);
      });
    } else {
      announcementsList.innerHTML = `<p style="color:#9ca3af;">No announcements yet.</p>`;
    }

    // âœ… Events
    const eventsList = document.getElementById('leaderEventsList');
    eventsList.innerHTML = '';
    if (clubData.club.events.length > 0) {
      clubData.club.events.forEach(e => {
        const div = document.createElement('div');
        div.className = 'event-item';
        div.innerHTML = `
          <p><strong>${e.title}</strong></p>
          <p>${e.date}</p>
        `;
        eventsList.appendChild(div);
      });
    } else {
      eventsList.innerHTML = `<p style="color:#9ca3af;">No events yet.</p>`;
    }



    // âœ… Members
    const membersList = document.getElementById('leaderMembersList');
    membersList.innerHTML = '';
    if (clubData.club.members.length > 0) {
      clubData.club.members.forEach(memberId => {
        const memberDiv = document.createElement('div');
        memberDiv.className = 'club-item';
        memberDiv.innerHTML = `
          <p>Member ID: ${memberId}</p>
          <button class="btn btn-danger" onclick="removeMember(${leaderClubId}, ${memberId})">Remove</button>
        `;
        membersList.appendChild(memberDiv);
      });
    } else {
      membersList.innerHTML = `<p style="color:#9ca3af;">No members in this club.</p>`;
    }

  } catch (error) {
    console.error('Error rendering leader dashboard:', error);
  }
}

// Members list
const membersList = document.getElementById('leaderMembersList');
membersList.innerHTML = '';
if (clubData.club.members.length > 0) {
  clubData.club.members.forEach(member => {
    const div = document.createElement('div');
    div.className = 'club-item';
    div.innerHTML = `
      <strong>${member.name}</strong> 
      <button onclick="removeMember(${clubData.club.id}, ${member.id})" class="btn btn-danger" style="float:right;">ðŸ—‘ Remove</button>
    `;
    membersList.appendChild(div);
  });
} else {
  membersList.innerHTML = '<p style="color:#9ca3af;">No members found.</p>';
}


// ===============================
// Delete Club Announcement
// ===============================
async function deleteClubAnnouncement(clubId, announcementId) {
  try {
    await apiCall(`/clubs/${clubId}/announcements/${announcementId}`, {
      method: 'DELETE'
    });
    renderLeaderDashboard();
  } catch (err) {
    console.error(err);
  }
}

// ===============================
// Open Modal for Club (Announce/Event)
// ===============================
function openModalForClub(type) {
  const leaderClubId = currentUser.leaderOf;
  // Reuse your existing openModal but pass clubId
  openModal(type, leaderClubId);
}


function renderClubs() {
  const grid = document.getElementById('clubsGrid');
  grid.innerHTML = '';

  if (database.clubs.length === 0) {
    grid.innerHTML = `
      <div class="empty-state" style="grid-column: 1 / -1;">
        <div class="empty-state-icon">ðŸŽ­</div>
        <p>No clubs available yet</p>
      </div>`;
    return;
  }

  database.clubs.forEach(club => {
    const card = document.createElement('div');
    card.className = 'card club-card';
    card.onclick = () => openClubModal(club);

    const isMember = currentUser?.type === 'Member';
    const isLeader = currentUser?.type === 'Leader' && currentUser?.leaderOf === club.id;
    const isAdmin = currentUser?.type === 'Admin';
    const joined = currentUser?.clubs?.includes(club.id);

    let buttonHTML = '';
    if (isMember) {
      buttonHTML = `
        <div style="display:flex; justify-content:center; margin-bottom:1rem;">
          <button id="joinBtn-${club.id}" 
                  class="btn ${joined ? 'btn-danger' : 'btn-primary'}"
                  data-club-id="${club.id}">
            ${joined ? 'Leave Club' : 'Join Club'}
          </button>
        </div>
      `;
    } else if (isLeader) {
      buttonHTML = `
        <div style="text-align:center; margin-bottom:1rem;">
          <span class="badge" style="background:#2563eb;color:white;padding:0.3rem 0.6rem;border-radius:8px;">
             You lead this club
          </span>
        </div>
      `;
    }

    card.innerHTML = `
      <img src="${club.image || 'https://via.placeholder.com/300x150?text=No+Image'}"
           alt="${club.name}"
           style="width:100%; height:180px; object-fit:cover; border-radius:0.75rem 0.75rem 0 0; margin-bottom:1rem;">
      <h3 style="font-size:1.25rem; font-weight:bold; text-align:center; margin-bottom:0.5rem;">
        ${club.name}
      </h3>
      <p style="color:#9ca3af; text-align:center; margin-bottom:1rem;">
        ${club.description?.substring(0, 100) || 'No description available'}...
      </p>
      ${buttonHTML}
      <div style="text-align:center; font-size:0.875rem; color:#9ca3af;">
        ðŸ‘¥ ${club.members?.length || 0} members â€¢ ðŸ“… ${club.events?.length || 0} events
      </div>
    `;

    grid.appendChild(card);
  });

  // âœ… Attach button click listeners after rendering
  if (currentUser?.type === 'Member') {
    document.querySelectorAll('[id^="joinBtn-"]').forEach(btn => {
      const clubId = parseInt(btn.dataset.clubId);
      btn.addEventListener('click', async (e) => {
        e.stopPropagation();

        const joined = currentUser.clubs.includes(clubId);
        if (joined) {
          await leaveClub(clubId);
        } else {
          await joinClub(clubId);
        }

        updateClubButtonState(clubId); // instant UI update
      });
    });
  }
}



function openClubModal(club) {
  const modal = document.getElementById('modal');
  const title = document.getElementById('modalTitle');
  const body = document.getElementById('modalBody');
  
  title.textContent = club.name;
  body.innerHTML = `
    <img src="${club.image}" alt="${club.name}" style="width:100%; border-radius:8px; margin-bottom:1rem;">
    <p style="margin-bottom:1rem;">${club.description}</p>
    <p style="color:#9ca3af;">ðŸ‘¥ ${club.members?.length || 0} members</p>
    <div style="margin-top:1.5rem; display:flex; gap:1rem;">
  ${
    currentUser?.type === 'Member'
      ? `
        <button id="modalJoinBtn-${club.id}" 
                class="btn ${currentUser.clubs.includes(club.id) ? 'btn-danger' : 'btn-primary'}"
                data-club-id="${club.id}">
          ${currentUser.clubs.includes(club.id) ? 'Leave Club' : 'Join Club'}
        </button>
      `
      : ''
  }
</div>

  `;
  
  modal.classList.add('active');
}
// âœ… Make the modal button functional
if (currentUser?.type === 'Member') {
  const modalBtn = document.getElementById(`modalJoinBtn-${club.id}`);
  if (modalBtn) {
    modalBtn.addEventListener('click', async () => {
      const joined = currentUser.clubs.includes(club.id);
      if (joined) await leaveClub(club.id);
      else await joinClub(club.id);
      updateClubButtonState(club.id);
      openClubModal(club); // re-render modal instantly
    });
  }
}


async function removeClubLeader(clubId) {
  if (!confirm("Remove this club's leader?")) return;

  try {
    await apiCall(`/clubs/${clubId}`, {
      method: 'PUT',
      body: JSON.stringify({ leaderId: null })
    });

    const updated = await apiCall('/clubs');
    database.clubs = updated.clubs || [];

    showMessage('Leader removed successfully!', 'success');
    renderClubs();
  } catch (err) {
    alert('Failed to remove leader: ' + err.message);
  }
}


        function renderProfile() {
            document.getElementById('profileAvatar').textContent = currentUser.email.charAt(0).toUpperCase();
            document.getElementById('profileName').textContent = currentUser.email.split('@')[0];
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('profileRole').textContent = currentUser.role;
            
            // Handle Edit Profile Form Submission
document.getElementById('editProfileForm').addEventListener('submit', async function (e) {
  e.preventDefault();

  const updatedData = {
    name: document.getElementById('editName').value.trim(),
    email: document.getElementById('editEmail').value.trim(),
    birthday: document.getElementById('editBirthday').value,
    about_me: document.getElementById('editAbout').value.trim(),
    year_section: document.getElementById('editYearSection').value.trim(),
    course: document.getElementById('editCourse').value.trim()
  };

  try {
    const res = await fetch(`${API_BASE_URL}/members/${currentUser.id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updatedData)
    });

    const data = await res.json();

    if (!res.ok) throw new Error(data.error || 'Update failed');

    alert('Profile updated successfully!');

    // âœ… Use the updated record returned by backend if available
    if (data.member) {
      currentUser = data.member;
    } else {
      currentUser = { ...currentUser, ...updatedData };
    }

    // âœ… Instantly re-render profile
    renderProfile();

    // Hide edit form again
    document.getElementById('editProfileForm').classList.add('hidden');
    document.getElementById('basicInfo').classList.remove('hidden');
  } catch (err) {
    alert('Failed to update profile: ' + err.message);
  }
});


                // Disable editing if Admin
    if (currentUser.role === 'Admin') {
        document.getElementById('editProfileBtn').disabled = true;
        document.getElementById('editProfileBtn').textContent = 'Admin profile locked';
        document.getElementById('editProfileBtn').classList.add('btn-secondary');
    }

            const clubsDiv = document.getElementById('profileClubs');
            clubsDiv.innerHTML = '';
            
           if (currentUser.clubs && currentUser.clubs.length > 0) {
  currentUser.clubs.forEach(clubId => {
    const club = database.clubs.find(c => c.id === clubId);
    if (club) {
      const div = document.createElement('div');
      div.className = 'club-item';
      div.style.cursor = 'pointer';
      div.onclick = () => openMemberClubModal(club);
      div.innerHTML = `
        <strong>${club.name}</strong>
        <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 0.25rem;">
          ðŸ‘¥ ${club.members ? club.members.length : 0} members
        </p>
      `;
      clubsDiv.appendChild(div);
    }
  });


            } else {
                clubsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ðŸŽ­</div><p>You haven\'t joined any clubs yet</p></div>';
            }
        }
async function openModal(type) {
  const modal = document.getElementById('modal');
  const title = document.getElementById('modalTitle');
  const body = document.getElementById('modalBody');

  modal.classList.add('active');
  title.innerHTML = '';
  body.innerHTML = '<div class="loading">Loading...</div>';

  // ðŸŸ¦ Announcement
  if (type === 'announcement') {
    title.innerHTML = '<span style="display:flex;align-items:center;gap:0.5rem;"><strong>Post Announcement</strong></span>';
    body.innerHTML = `
      <form onsubmit="postAnnouncement(event)" style="display:flex;flex-direction:column;gap:1rem;">
        <div>
          <label class="label"><strong>Announcement</strong></label>
          <textarea id="announcementText" class="textarea" rows="4" placeholder="Write your announcement here..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;font-weight:600;">Post Announcement</button>
      </form>
    `;
  }

  // ðŸŸ© Create New Club
  else if (type === 'createClub') {
    title.innerHTML = '<span style="display:flex;align-items:center;gap:0.5rem;"> <strong>Create New Club</strong></span>';
    body.innerHTML = `
      <form onsubmit="createClub(event)" style="display:flex;flex-direction:column;gap:1rem;">
        <div>
          <label class="label"><strong>Club Name</strong></label>
          <input id="clubName" class="input" placeholder="Photography Club" required>
        </div>

        <div>
          <label class="label"><strong>Description</strong></label>
          <textarea id="clubDescription" class="textarea" rows="4" placeholder="Describe your club..." required></textarea>
        </div>

        <div>
          <label class="label"><strong>Image URL</strong></label>
          <input id="clubImage" class="input" placeholder="https://example.com/image.jpg" required>
        </div>

        <button type="submit" class="btn btn-primary" style="width:100%;font-weight:600;">Create Club</button>
      </form>
    `;
  }

  // ðŸŸ¨ Assign Club Leader
  else if (type === 'assignLeader') {
    await openAssignLeaderModal();
    return;
  }



  modal.classList.add('active');
}

async function openMemberClubModal(club) {
  const modal = document.getElementById('modal');
  const title = document.getElementById('modalTitle');
  const body = document.getElementById('modalBody');

  modal.classList.add('active');
  title.textContent = club.name;
  body.innerHTML = '<div class="loading">Loading club info...</div>';

  try {
    // âœ… Use already-loaded club data
    const c = database.clubs.find(c => c.id === club.id);
    if (!c) throw new Error('Club not found in cache.');

    // âœ… Fetch membership info (optional)
    const membershipRes = await apiCall(`/clubs/${club.id}/membership`);
    const membership = membershipRes || {};

    // ðŸŸ¦ Announcements
    const announcementsHTML = c.announcements?.length
      ? c.announcements.map(a => `
        <div class="announcement-item">
          <p>${a.text}</p>
          <p style="font-size:0.75rem; color:#9ca3af;">ðŸ“… ${a.date}</p>
        </div>`).join('')
      : `<p style="color:#9ca3af;">No announcements yet.</p>`;

    // ðŸŸ¨ Events
    const eventsHTML = c.events?.length
      ? c.events.map(e => `
        <div class="event-item">
          <p><strong>${e.title}</strong></p>
          <p style="font-size:0.875rem; color:#9ca3af;">ðŸ“… ${e.date}</p>
          <p>${e.description || ''}</p>
        </div>`).join('')
      : `<p style="color:#9ca3af;">No events yet.</p>`;

    // ðŸ’³ Membership
    const membershipHTML = `
      <div>
        <p><strong>Account Name:</strong> ${membership.membership_name || 'â€”'}</p>
        <p><strong>Account Number:</strong> ${membership.membership_number || 'â€”'}</p>
        <p><strong>Description:</strong> ${membership.membership_description || 'â€”'}</p>
        ${membership.membership_image
          ? `<img src="${membership.membership_image}" alt="QR Code" style="width:150px; border-radius:8px; margin-top:1rem;">`
          : ''}
      </div>
    `;

    // âœ… Render final modal
    body.innerHTML = `
      <div>
        <img src="${c.image || 'https://via.placeholder.com/400x200?text=No+Image'}" 
             alt="${c.name}" 
             style="width:100%; border-radius:8px; margin-bottom:1rem;">
        <p>${c.description || 'No description available'}</p>

        <hr style="margin:1.5rem 0; opacity:0.2;">
        <h4>Announcements</h4>
        ${announcementsHTML}

        <hr style="margin:1.5rem 0; opacity:0.2;">
        <h4>Events</h4>
        ${eventsHTML}

        <hr style="margin:1.5rem 0; opacity:0.2;">
        <h4>Membership Info</h4>
        ${membershipHTML}

        <div style="display:flex; justify-content:center; margin-top:1.5rem;">
          ${
            currentUser?.clubs?.includes(c.id)
              ? `<button class="btn btn-danger" onclick="leaveClub(${c.id})">Leave Club</button>`
              : `<button class="btn btn-primary" onclick="joinClub(${c.id})">Join Club</button>`
          }
        </div>
      </div>
    `;
  } catch (err) {
    console.error('Error loading club modal:', err);
    body.innerHTML = '<div class="error">Failed to load club info.</div>';
  }
}

// â‘¡ Dedicated helper for loading clubs + members asynchronously
async function openAssignLeaderModal(preselectedClubId = null) {
  const modal = document.getElementById('modal');
  const title = document.getElementById('modalTitle');
  const body = document.getElementById('modalBody');

  modal.classList.add('active');
  title.textContent = 'Assign Club Leader';
  body.innerHTML = `
    <div style="margin-bottom:1rem;">
      <label><strong>Select Club:</strong></label>
      <select id="leaderClubSelect" class="input"></select>
    </div>
    <div style="margin-bottom:1rem;">
      <label><strong>Select Leader (Member):</strong></label>
      <select id="leaderMemberSelect" class="input"></select>
    </div>
    <button onclick="assignLeaderToClub()" class="btn btn-primary" style="width:100%;">Assign Leader</button>
  `;

  // fetch lists
  const clubsRes = await apiCall('/clubs');
  const membersRes = await apiCall('/members');

  const clubSelect = document.getElementById('leaderClubSelect');
  clubsRes.clubs.forEach(c =>
    clubSelect.insertAdjacentHTML('beforeend', `<option value="${c.id}">${c.name}</option>`)
  );

  const memberSelect = document.getElementById('leaderMemberSelect');
  membersRes.members.forEach(m =>
    memberSelect.insertAdjacentHTML('beforeend', `<option value="${m.id}">${m.name} (${m.student_id})</option>`)
  );

  // âœ… Automatically preselect the right club if provided
  if (preselectedClubId) {
    clubSelect.value = preselectedClubId;
  }
}

        function closeModal(event) {
            if (event && event.target.id !== 'modal') return;
            document.getElementById('modal').classList.remove('active');
        }

        async function postAnnouncement() {
            const text = document.getElementById('announcementText').value.trim();
            if (!text) {
                alert('Please enter announcement text');
                return;
            }
            
            try {
                await apiCall('/announcements', {
                    method: 'POST',
                    body: JSON.stringify({ text })
                });
                
                const announcementsData = await apiCall('/announcements');
                database.generalAnnouncements = announcementsData.announcements || [];
                
                closeModal();
                showMessage('Announcement posted successfully!', 'success');
                renderAdminDashboard();
            } catch (error) {
                alert(error.message || 'Failed to post announcement');
            }
        }

        async function createEvent(e) {
            e.preventDefault();
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const description = document.getElementById('eventDescription').value;
            const clubId = document.getElementById('eventClub').value;
            
            try {
                await apiCall('/events', {
                    method: 'POST',
                    body: JSON.stringify({
                        title,
                        date,
                        description,
                        clubId: clubId === 'general' ? null : parseInt(clubId)
                    })
                });
                
                const [eventsData, clubsData] = await Promise.all([
                    apiCall('/events'),
                    apiCall('/clubs')
                ]);
                database.generalEvents = eventsData.events || [];
                database.clubs = clubsData.clubs || [];
                
                closeModal();
                showMessage('Event created successfully!', 'success');
                showPage('dashboard');
            } catch (error) {
                alert(error.message || 'Failed to create event');
            }
        }

        async function createClub(e) {
  e.preventDefault();
  const name = document.getElementById('clubName').value.trim();
  const description = document.getElementById('clubDescription').value.trim();
  const image = document.getElementById('clubImage').value.trim();

  try {
    const res = await fetch('/api/clubs', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        name,
        description,
        image,
        adminId: currentUser.id
      })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Failed to create club');

    // ðŸŸ© Re-fetch updated list
    const clubsData = await apiCall('/clubs');
    database.clubs = clubsData.clubs || [];

    closeModal();
    showMessage('âœ… Club created successfully!', 'success');
    renderAdminDashboard(); // refresh data
  } catch (err) {
    alert('Error: ' + err.message);
  }
}


async function joinClub(clubId) {
  try {
    await apiCall(`/clubs/${clubId}/join`, {
      method: 'POST',
      body: JSON.stringify({ memberId: currentUser.id })
    });

    // ðŸŸ© Instantly update local user data
    if (!currentUser.clubs.includes(clubId)) {
      currentUser.clubs.push(clubId);
    }

    // ðŸŸ© Refresh club info safely
    await refreshClubCard(clubId);

    showMessage('Joined club successfully!', 'success');
  } catch (err) {
    showMessage(err.message || 'Failed to join club', 'error');
  }
}

async function leaveClub(clubId) {
  try {
    await apiCall(`/clubs/${clubId}/leave`, {
      method: 'POST',
      body: JSON.stringify({ memberId: currentUser.id })
    });

    // ðŸŸ© Instantly remove locally
    currentUser.clubs = currentUser.clubs.filter(id => id !== clubId);

    await refreshClubCard(clubId);

    showMessage('Left club successfully!', 'success');
  } catch (err) {
    showMessage(err.message || 'Failed to leave club', 'error');
  }
}

// ðŸ”„ Helper: re-fetch that club safely
async function refreshClubCard(clubId) {
  try {
    const clubData = await apiCall(`/clubs/${clubId}`);
    const club = clubData.club;

    if (club) {
      updateClubButtonState(clubId); // re-render join/leave button
    }
  } catch {
    console.warn('Club info refresh skipped');
  }
}

// ðŸŸ© Update button state (Join â†” Leave)
function updateClubButtonState(clubId) {
  const btn = document.querySelector(`#joinBtn-${clubId}`);
  if (!btn) return;

  const joined = currentUser.clubs.includes(clubId);
  btn.textContent = joined ? 'Leave Club' : 'Join Club';
  btn.classList.toggle('btn-danger', joined);
  btn.classList.toggle('btn-primary', !joined);
  btn.setAttribute('onclick', joined ? `leaveClub(${clubId})` : `joinClub(${clubId})`);
}



        async function deleteClub(clubId) {
    if (!confirm("Are you sure you want to delete this club?")) return;

    try {
        await apiCall(`/clubs/${clubId}`, {
            method: 'DELETE'
        });

        database.clubs = database.clubs.filter(c => c.id !== clubId);
        renderClubs();
        showMessage('Club deleted successfully!', 'success');
    } catch (error) {
        alert(error.message || 'Failed to delete club');
    }
}





function editClubDescription(clubId) {
    const club = database.clubs.find(c => c.id === clubId);
    if (!club) return alert("Club not found.");

    const newDesc = prompt("Enter new description:", club.description);
    if (newDesc === null) return;

    apiCall(`/clubs/${clubId}`, {
        method: 'PUT',
        body: JSON.stringify({ description: newDesc })
    }).then(() => {
        club.description = newDesc;
        renderClubs();
        showMessage('Description updated!', 'success');
    }).catch(err => {
        alert(err.message || 'Failed to update description');
    });
}

function editClubLeader(clubId) {
    const club = database.clubs.find(c => c.id === clubId);
    if (!club) return alert("Club not found.");

    const newLeaderId = prompt("Enter new leader user ID:", club.adminId || "");
    if (newLeaderId === null) return;

    apiCall(`/clubs/${clubId}`, {
        method: 'PUT',
        body: JSON.stringify({ adminId: parseInt(newLeaderId) })
    }).then(() => {
        club.adminId = parseInt(newLeaderId);
        renderClubs();
        showMessage('Club leader updated!', 'success');
    }).catch(err => {
        alert(err.message || 'Failed to update leader');
    });
}
async function loadAnnouncements() {
  try {
    const data = await apiCall('/announcements');
    database.generalAnnouncements = data.announcements || [];
    // If admin dashboard visible, re-render
    if (!document.getElementById('adminDashboard').classList.contains('hidden')) {
      renderAdminDashboard();
    }
  } catch (err) {
    console.error('Failed to load announcements:', err);
  }
}

async function deleteAnnouncement(id) {
  if (!confirm('Delete announcement?')) return;
  try {
    await apiCall(`/announcements/${id}`, { method: 'DELETE' });
    await loadAnnouncements();
    alert('Announcement deleted');
  } catch (err) {
    console.error('Error deleting announcement:', err);
    alert('Failed to delete announcement');
  }
}

// âœ… Signup handler
async function signup(event) {
  event.preventDefault();

  const name = document.getElementById('signupName').value.trim();
  const studentID = document.getElementById('signupStudentID').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const password = document.getElementById('signupPassword').value.trim();
  const signupBtn = document.getElementById('signupBtn');

  signupBtn.disabled = true;
  signupBtn.textContent = "Signing up...";

  try {
    const res = await apiCall('/auth/register', {
      method: 'POST',
      body: JSON.stringify({ name, studentID, email, password, role: 'Member' })
    });

    // Some APIs return the created user; if so, save it so user can be auto-logged in
    if (res.user) {
      currentUser = res.user;
      try { localStorage.setItem('user', JSON.stringify(currentUser)); } catch {}
    }

    showSignupMessage('signupSuccess', 'Account created successfully! You can now login.');
    setTimeout(() => showLogin(), 1500);
  } catch (err) {
    showSignupMessage('signupError', err.message || 'Signup failed. Please try again.');
  } finally {
    signupBtn.disabled = false;
    signupBtn.textContent = "Sign Up";
  }
}

function showSignupMessage(id, msg) {
  const el = document.getElementById(id);
  if (!el) return;
  el.textContent = msg;
  el.classList.remove('hidden');
  setTimeout(() => el.classList.add('hidden'), 4000);
}

function showSignup() {
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('signupPage').classList.remove('hidden');
}

function showLogin() {
  document.getElementById('signupPage').classList.add('hidden');
  document.getElementById('loginPage').classList.remove('hidden');
}
// ==========================
// âœ… PROFILE PAGE HANDLER (FINAL FIXED VERSION)
// ==========================

// Load user from localStorage
currentUser = JSON.parse(localStorage.getItem('user') || '{}');

// Element references (these exist once DOM is ready)
let profileName, profileEmail, profileRole, profileID, profileJoined, profileCourse, profileYearSection, profileAbout;
let editProfileBtn, editProfileForm;

// ==========================
// Initialize after DOM is loaded
// ==========================
document.addEventListener('DOMContentLoaded', () => {
  // Grab profile elements safely
  profileName = document.getElementById('profileName');
  profileEmail = document.getElementById('profileEmail');
  profileRole = document.getElementById('profileRole');
  profileID = document.getElementById('profileID');
  profileJoined = document.getElementById('profileJoined');
  profileCourse = document.getElementById('profileCourse');
  profileYearSection = document.getElementById('profileYearSection');
  profileAbout = document.getElementById('profileAbout');
  editProfileBtn = document.getElementById('editProfileBtn');
  editProfileForm = document.getElementById('editProfileForm');

  // Only attach handlers if profile exists
  if (editProfileBtn && editProfileForm) {
    attachProfileHandlers();
  }

  // Auto-login handler
  const savedUser = JSON.parse(localStorage.getItem('user') || 'null');
  if (savedUser && savedUser.id) {
    currentUser = savedUser;
    loadInitialData().then(() => {
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      showPage('dashboard');
      loadProfile(); // load profile once logged in
    });
  } else {
    loadInitialData().catch(() => {});
  }
});

// ==========================
// Load Profile Data
// ==========================
async function loadProfile() {
  if (!currentUser?.id) return console.warn('âš ï¸ No logged-in user found');

  try {
    const res = await fetch(`/api/members/${currentUser.id}`);
    const data = await res.json();
    if (!res.ok || !data.member) throw new Error('Failed to load profile');

    const m = data.member;

    // Fill displayed info
    profileName.textContent = m.name || 'â€”';
    profileEmail.textContent = m.email || 'â€”';
    profileRole.textContent = m.role || 'Member';
    profileID.textContent = m.student_id || 'â€”';
    profileJoined.textContent = m.joined_at ? new Date(m.joined_at).toLocaleDateString() : 'â€”';
    profileCourse.textContent = m.course || 'â€”';
    profileYearSection.textContent = m.year_section || 'â€”';
    profileAbout.textContent = m.about_me || 'â€”';

    // Pre-fill edit form fields
    document.getElementById('editName').value = m.name || '';
    document.getElementById('editUsername').value = m.username || '';
    document.getElementById('editEmail').value = m.email || '';
    document.getElementById('editBirthday').value = m.birthday || '';
    document.getElementById('editAbout').value = m.about_me || '';
    document.getElementById('editYearSection').value = m.year_section || '';
    document.getElementById('editCourse').value = m.course || '';
  } catch (err) {
    console.error('Error loading profile:', err);
  }
}

// ==========================
// Attach Profile Button + Form Handlers
// ==========================
function attachProfileHandlers() {
  // Toggle Edit Mode
  editProfileBtn.addEventListener('click', () => {
    const form = editProfileForm;
    const basicInfo = document.getElementById('basicInfo');
    const isHidden = form.classList.contains('hidden');

    form.classList.toggle('hidden', !isHidden);
    basicInfo.classList.toggle('hidden', isHidden);
    editProfileBtn.textContent = isHidden ? 'Cancel Edit' : 'Edit Profile';
  });

  // Save Profile Changes
  editProfileForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const updated = {
      name: document.getElementById('editName').value,
      username: document.getElementById('editUsername').value,
      email: document.getElementById('editEmail').value,
      birthday: document.getElementById('editBirthday').value,
      about_me: document.getElementById('editAbout').value,
      year_section: document.getElementById('editYearSection').value,
      course: document.getElementById('editCourse').value
    };

    try {
      const res = await fetch(`/api/members/${currentUser.id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updated)
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Update failed');

      alert('âœ… Profile updated successfully!');
      currentUser = { ...currentUser, ...updated };
      localStorage.setItem('user', JSON.stringify(currentUser));

      await loadProfile();
      editProfileForm.classList.add('hidden');
      document.getElementById('basicInfo').classList.remove('hidden');
      editProfileBtn.textContent = 'Edit Profile';
    } catch (err) {
      console.error('Error updating profile:', err);
      alert('âŒ Failed to update profile.');
    }
  });
}

// ==========================
// Optional: View Member Quick Modal
// ==========================
function viewMemberProfile(memberId) {
  openMemberModal(memberId);
}

function openMemberModal(memberId) {
  const modal = document.getElementById('modal');
  const title = document.getElementById('modalTitle');
  const body = document.getElementById('modalBody');

  title.textContent = 'Member Details';
  body.innerHTML = `<div class="loading">Loading...</div>`;
  modal.classList.add('active');

  // Try fetching member details from API
  fetch(`${API_BASE_URL}/members/${memberId}`)
    .then(r => r.json())
    .then(data => {
      if (data.member) {
        const m = data.member;
        body.innerHTML = `
          <div style="display:flex; gap:1rem; align-items:center;">
            <div class="avatar">${(m.name || m.email || '').charAt(0).toUpperCase()}</div>
            <div>
              <h4 style="margin:0;">${m.name || m.email}</h4>
              <p style="color:#9ca3af; margin:0;">${m.email || ''}</p>
              <p style="color:#9ca3af; margin:0;">Student ID: ${m.student_id || ''}</p>
            </div>
          </div>
        `;
      } else {
        body.innerHTML = '<div class="empty-state"><p>Member not found</p></div>';
      }
    })
    .catch(err => {
      console.error(err);
      body.innerHTML = '<div class="empty-state"><p>Failed to load member</p></div>';
    });
}

// Remove a member from the club (leader action)
// Uses the existing /clubs/:id/leave POST endpoint with memberId (server supports this).
async function removeMemberFromClub(memberId, clubId) {
  if (!confirm('Remove this member from the club?')) return;

  try {
    // Call API to remove link (server expects userId)
    await apiCall(`/clubs/${clubId}/leave`, {
      method: 'POST',
      body: JSON.stringify({ memberId })
    });

    // Update local DB representation
    const club = database.clubs.find(c => c.id === clubId);
    if (club && club.members) {
      club.members = club.members.filter(id => id !== memberId);
    }

    // If we had currentUser in club members, update that too
    if (currentUser.id === memberId) {
      currentUser.clubs = currentUser.clubs.filter(id => id !== clubId);
    }

    showMessage('Member removed from club', 'success');
    renderLeaderDashboard();
  } catch (err) {
    console.error('Failed to remove member:', err);
    showMessage('Failed to remove member', 'error');
  }
}

// Internal implementation for assigning a leader. Accepts optional clubId param.
async function assignLeaderToClubInternal(clubId = null) {
  const clubSelect = document.getElementById('leaderClubSelect');
  const memberSelect = document.getElementById('leaderMemberSelect');

  const cid = clubId || (clubSelect ? clubSelect.value : null);
  const leaderId = memberSelect ? memberSelect.value : null;

  if (!cid || !leaderId) {
    alert('Please select both club and leader.');
    return;
  }

  try {
    await apiCall(`/clubs/${cid}`, {
      method: 'PUT',
      body: JSON.stringify({ leaderId })
    });
    alert('âœ… Leader assigned successfully!');
    closeModal();
    renderAdminDashboard();
  } catch (error) {
    alert('âŒ Failed to assign leader: ' + error.message);
  }
}

// Backwards-compatible wrapper used by inline onclicks
function assignLeaderToClub(clubId = null) {
  return assignLeaderToClubInternal(clubId);
}
async function loadLeaderMembers() {
  try {
    const membersData = await apiCall('/members'); // or your actual endpoint
    database.members = membersData.members || [];
    renderLeaderMemberDropdown(database.members);
  } catch (err) {
    console.error('Error loading members:', err);
  }
}

function renderLeaderMemberDropdown(members) {
  const select = document.getElementById('leaderMemberSelect');
  if (!select) return;

  select.innerHTML = members.length
    ? members.map(m => `<option value="${m.id}">${m.name} (${m.email})</option>`).join('')
    : '<option disabled>No members found</option>';
}

function filterLeaderMembers() {
  const search = document.getElementById('memberSearch').value.toLowerCase();
  const filtered = database.members.filter(m => m.name.toLowerCase().includes(search));
  renderLeaderMemberDropdown(filtered);
}

async function setLeader(clubId) {
  const modal = document.getElementById('modal');
  const title = document.getElementById('modalTitle');
  const body = document.getElementById('modalBody');

  modal.classList.add('active');
  title.textContent = 'Assign Club Leader';
  body.innerHTML = `
    <div style="margin-bottom: 1rem;">
      <label><strong>Select Leader (Member):</strong></label>
      <select id="leaderMemberSelect" class="input"></select>
    </div>
    <button onclick="assignLeaderToClub(${clubId})" class="btn btn-primary" style="width: 100%;">ðŸ’¾ Assign Leader</button>
  `;

  const membersRes = await apiCall('/members');
  const memberSelect = document.getElementById('leaderMemberSelect');
  membersRes.members.forEach(m => {
    const opt = document.createElement('option');
    opt.value = m.id;
    opt.textContent = `${m.name} (${m.student_id})`;
    memberSelect.appendChild(opt);
  });
}

async function assignLeaderToClub(clubId) {
  const leaderId = document.getElementById('leaderMemberSelect').value;

  if (!leaderId) {
    alert('Please select a leader.');
    return;
  }

  await apiCall(`/clubs/${clubId}`, {
    method: 'PUT',
    body: JSON.stringify({ leaderId })
  });

  alert('âœ… Leader assigned successfully!');
  closeModal();
  renderAdminDashboard();
}

// Initialize profile when profilePage is shown
loadProfile();
function logout() {
  // Clear user session
  localStorage.removeItem('user');
  currentUser = null;

  // Hide main app and show login page again
  document.getElementById('mainApp').classList.add('hidden');
  document.getElementById('loginPage').classList.remove('hidden');

  // Optional: reset dashboards
  document.getElementById('adminDashboard').classList.add('hidden');
  document.getElementById('leaderDashboard').classList.add('hidden');
  document.getElementById('memberDashboard').classList.add('hidden');

  // Optional: clear any form data or modals
  document.getElementById('modal').classList.remove('active');

  console.log("User logged out successfully");
}

async function loadMembersForLeader() {
  try {
    const membersData = await apiCall('/members');
    database.members = membersData.members || [];

    renderMemberDropdown(database.members);
  } catch (err) {
    console.error('Error loading members:', err);
  }
}

function renderMemberDropdown(members) {
  const select = document.getElementById('assignLeaderMember');
  if (!select) return;

  select.innerHTML = members.length
    ? members.map(m => `<option value="${m.id}">${m.name} (${m.email})</option>`).join('')
    : '<option disabled>No members found</option>';
}

function filterMembers() {
  const search = document.getElementById('memberSearch').value.toLowerCase();
  const filtered = database.members.filter(m => m.name.toLowerCase().includes(search));
  renderMemberDropdown(filtered);
}
// ============================
// âœ… CREATE CLUB HANDLER
// ============================
async function createClub(event) {
  event.preventDefault();
  
  const name = document.getElementById('clubName').value.trim();
  const description = document.getElementById('clubDescription').value.trim();
  const image = document.getElementById('clubImage').value.trim();

  try {
    // ðŸŸ¦ Create the club in the database
    const data = await apiCall('/clubs', {
      method: 'POST',
      body: JSON.stringify({
        name,
        description,
        image,
        adminId: currentUser?.id || null
      })
    });

    // ðŸŸ© Instantly update local data (no page refresh)
    database.clubs.push(data.club);

    // ðŸŸ© Re-render admin dashboard + clubs page
    renderAdminDashboard();
    renderClubs();

    // ðŸŸ© Close modal and notify user
    closeModal();
    showMessage('Club created successfully!', 'success');
  } catch (error) {
    console.error('Failed to create club:', error);
    showMessage(error.message || 'Failed to create club', 'error');
  }
}

// ======================
// LEADER QUICK ACTION FIX
// ======================

function openModalForClub(type) {
  const modal = document.getElementById('modal');
  const title = document.getElementById('modalTitle');
  const body = document.getElementById('modalBody');

  modal.classList.add('active');

  if (!currentUser || !currentUser.leaderOf) {
    body.innerHTML = `<p style="color:red;">You are not assigned as a club leader.</p>`;
    return;
  }

  if (type === 'announcement') {
    title.textContent = 'Post Club Announcement';
    body.innerHTML = `
      <form onsubmit="submitClubAnnouncement(event)">
        <textarea id="clubAnnouncementText" class="textarea" placeholder="Write your announcement..." required></textarea>
        <button type="submit" class="btn btn-primary" style="margin-top:1rem;">Post</button>
      </form>
    `;
  }

  if (type === 'event') {
    title.textContent = 'Create Club Event';
    body.innerHTML = `
      <form onsubmit="submitClubEvent(event)">
        <input type="text" id="eventTitle" class="input" placeholder="Event title" required>
        <textarea id="eventDescription" class="textarea" placeholder="Event description" required></textarea>
        <input type="date" id="eventDate" class="input" required>
        <button type="submit" class="btn btn-primary" style="margin-top:1rem;">Create</button>
      </form>
    `;
  }
}

async function submitClubAnnouncement(e) {
  e.preventDefault();
  const text = document.getElementById('clubAnnouncementText').value;
  try {
    await apiCall(`/clubs/${currentUser.leaderOf}/announcements`, {
      method: 'POST',
      body: JSON.stringify({ text })
    });
    closeModal();
    alert('Announcement posted successfully!');
    renderLeaderDashboard(); // refresh list
  } catch (err) {
    alert('Failed to post announcement: ' + err.message);
  }
}

async function submitClubEvent(e) {
  e.preventDefault();
  const title = document.getElementById('eventTitle').value;
  const description = document.getElementById('eventDescription').value;
  const date = document.getElementById('eventDate').value;

  try {
    await apiCall('/events', {
      method: 'POST',
      body: JSON.stringify({
        title,
        description,
        date,
        clubId: currentUser.leaderOf
      })
    });
    closeModal();
    alert('Event created successfully!');
    renderLeaderDashboard(); // refresh list
  } catch (err) {
    alert('Failed to create event: ' + err.message);
  }
}

function openLeaderMembershipModal() {
  const modal = document.getElementById('modal');
  const title = document.getElementById('modalTitle');
  const body = document.getElementById('modalBody');
  modal.classList.add('active');

  title.textContent = 'Manage Club Membership';
  body.innerHTML = `
    <form onsubmit="submitMembershipInfo(event)">
      <input type="text" id="memNameInput" class="input" placeholder="Account Name" required>
      <input type="text" id="memNumberInput" class="input" placeholder="Account Number" required>
      <textarea id="memDescInput" class="textarea" placeholder="Description"></textarea>
      <input type="url" id="memImageInput" class="input" placeholder="Image URL (optional)">
      <button type="submit" class="btn btn-primary" style="margin-top:1rem;">Save</button>
    </form>
  `;
}

async function submitMembershipInfo(e) {
  e.preventDefault();
  const membershipName = document.getElementById('memNameInput').value;
  const membershipNumber = document.getElementById('memNumberInput').value;
  const membershipDescription = document.getElementById('memDescInput').value;
  const membershipImage = document.getElementById('memImageInput').value;

  try {
    await apiCall(`/clubs/${currentUser.leaderOf}/membership`, {
      method: 'POST',
      body: JSON.stringify({
  membership_name: membershipName,
  membership_number: membershipNumber,
  membership_description: membershipDescription,
  membership_image: membershipImage
})

    });
    closeModal();
    alert('Membership details updated!');
    renderLeaderDashboard();
  } catch (err) {
    alert('Failed to update membership info: ' + err.message);
  }
}
// ==============================
// LEADER DASHBOARD RENDER FIX
// ==============================
async function renderLeaderDashboard() {
  if (!currentUser || !currentUser.leaderOf) {
    document.getElementById('leaderClubInfo').innerHTML =
      `<p style="color:red;">You are not assigned as a club leader.</p>`;
    return;
  }

  const clubId = currentUser.leaderOf;

  try {
    // 1ï¸âƒ£ Get the club details (includes announcements + events + members)
    const clubData = await apiCall(`/clubs/${clubId}`);
    const club = clubData.club;

    // --- CLUB INFO ---
    const infoDiv = document.getElementById('leaderClubInfo');
    infoDiv.innerHTML = `
      <p><strong>Club Name:</strong> ${club.name}</p>
      <p><strong>Description:</strong> ${club.description || 'No description'}</p>
      <p><strong>Total Members:</strong> ${club.members ? club.members.length : 0}</p>
    `;

    // --- ANNOUNCEMENTS ---
    const announcementsList = document.getElementById('leaderAnnouncementsList');
    announcementsList.innerHTML = '';
    if (club.announcements && club.announcements.length > 0) {
      club.announcements.forEach(a => {
        const div = document.createElement('div');
        div.className = 'announcement-item';
        div.innerHTML = `
          <p style="font-weight:500;">${a.text}</p>
          <p style="font-size:0.75rem; color:#9ca3af;">ðŸ“… ${a.date}</p>
          <button class="btn btn-danger" style="margin-top:0.5rem;" onclick="deleteClubAnnouncement(${clubId}, ${a.id})">Delete</button>
        `;
        announcementsList.appendChild(div);
      });
    } else {
      announcementsList.innerHTML = `<p style="color:#9ca3af;">No announcements yet.</p>`;
    }

    // --- EVENTS ---
    const eventsList = document.getElementById('leaderEventsList');
    eventsList.innerHTML = '';
    if (club.events && club.events.length > 0) {
      club.events.forEach(e => {
        const div = document.createElement('div');
        div.className = 'event-item';
        div.innerHTML = `
          <p><strong>${e.title}</strong></p>
          <p style="color:#9ca3af;">ðŸ“… ${e.date}</p>
          <p>${e.description}</p>
          <button class="btn btn-danger" style="margin-top:0.5rem;" onclick="deleteClubEvent(${e.id})">Delete</button>
        `;
        eventsList.appendChild(div);
      });
    } else {
      eventsList.innerHTML = `<p style="color:#9ca3af;">No events yet.</p>`;
    }

    // --- MEMBERS ---
    const membersList = document.getElementById('leaderMembersList');
    membersList.innerHTML = '';
    if (club.members && club.members.length > 0) {
      club.members.forEach(m => {
        const div = document.createElement('div');
        div.className = 'club-item';
        div.innerHTML = `
          <p><strong>${m.name}</strong> (${m.role || 'Member'})</p>
          <button class="btn btn-danger" style="margin-top:0.25rem;" onclick="removeMember(${clubId}, ${m.id})">Remove</button>
        `;
        membersList.appendChild(div);
      });
    } else {
      membersList.innerHTML = `<p style="color:#9ca3af;">No members found.</p>`;
    }

    // --- MEMBERSHIP INFO ---
    try {
      const membership = await apiCall(`/clubs/${clubId}/membership`);
      if (membership && membership.membership_name) {
        document.getElementById('memName').textContent = membership.membership_name;
        document.getElementById('memNumber').textContent = membership.membership_number;
        document.getElementById('memDesc').textContent = membership.membership_description;

        const memImg = document.getElementById('memImage');
        if (membership.membership_image) {
          memImg.src = membership.membership_image;
          document.getElementById('memImageContainer').style.display = 'block';
        } else {
          document.getElementById('memImageContainer').style.display = 'none';
        }
      } else {
        document.getElementById('memName').textContent = 'â€”';
        document.getElementById('memNumber').textContent = 'â€”';
        document.getElementById('memDesc').textContent = 'â€”';
        document.getElementById('memImageContainer').style.display = 'none';
      }
    } catch {
      console.warn('No membership info found.');
    }

  } catch (err) {
    console.error('Failed to render leader dashboard:', err);
    document.getElementById('leaderClubInfo').innerHTML =
      `<p style="color:red;">Failed to load club details.</p>`;
  }
}
async function deleteClubAnnouncement(clubId, announcementId) {
  if (!confirm('Delete this announcement?')) return;
  try {
    await apiCall(`/clubs/${clubId}/announcements/${announcementId}`, { method: 'DELETE' });
    renderLeaderDashboard();
  } catch (err) {
    alert('Failed to delete announcement: ' + err.message);
  }
}

async function deleteClubEvent(eventId) {
  if (!confirm('Delete this event?')) return;
  try {
    await apiCall(`/events/${eventId}`, { method: 'DELETE' });
    renderLeaderDashboard();
  } catch (err) {
    alert('Failed to delete event: ' + err.message);
  }
}

async function removeMember(clubId, memberId) {
  if (!confirm('Remove this member?')) return;
  try {
    await apiCall(`/clubs/${clubId}/leave`, {
      method: 'POST',
      body: JSON.stringify({ userId: memberId })
    });
    renderLeaderDashboard();
  } catch (err) {
    alert('Failed to remove member: ' + err.message);
  }
}


    </script>
</body>
</html>